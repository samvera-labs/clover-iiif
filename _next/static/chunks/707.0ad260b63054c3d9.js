"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[707],{2950:function(e,t,i){let r;i.d(t,{Z:function(){return o}});var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));var o=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();let o=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=o[e];return t}return function(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}(o)}},3857:function(e,t,i){i.d(t,{j:function(){return ti}});var r=function(e){return function(){let t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},n="@iiif/IMPORT_ENTITIES",s="@iiif/MODIFY_ENTITY_FIELD",a="@iiif/REORDER_ENTITY_FIELD",o="@iiif/ADD_REFERENCE",l="@iiif/UPDATE_REFERENCE",u="@iiif/REMOVE_REFERENCE",c="@iiif/ADD_METADATA",p="@iiif/REMOVE_METADATA",d="@iiif/UPDATE_METADATA",f="@iiif/REORDER_METADATA",y=r(n)(),h=r(s)(),v=(r(a)(),r(o)(),r(u)(),r(l)(),r(c)(),r(d)(),r(p)(),r(f)(),"@iiif/ADD_MAPPING"),g="@iiif/ADD_MAPPINGS",m=r(v)(),b=r(g)(),A="RESOURCE_ERROR",S="RESOURCE_LOADING",C="RESOURCE_READY",R="@iiif/REQUEST_RESOURCE",O="@iiif/REQUEST_ERROR",w="@iiif/REQUEST_MISMATCH",E="@iiif/REQUEST_COMPLETE",T="@iiif/REQUEST_OFFLINE_RESOURCE",_=r(R)(),I=r(O)(),k=r(w)(),P=r(E)();r(T)();var D="@iiif/BATCH",M="@iiif/BATCH_IMPORT",j=r(D)();r(M)();var U=i(6390),x=i(7584),L=i(6722);function N(e){return"string"!=typeof e&&(e&&!e.type&&"source"in e?(e.type="SpecificResource",!0):!!e&&"SpecificResource"===e.type)}function q(...e){return t=>e.reduce((e,t)=>t(e),t)}var F=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"],$=class e{constructor(e,t={}){(0,L.a)(this,"traversals"),(0,L.a)(this,"options"),(0,L.a)(this,"_traverseManifest",q(this.traverseManifestItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,L.a)(this,"_traverseCanvas",q(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,L.a)(this,"_traverseAnnotationPage",q(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),(0,L.a)(this,"_traverseRange",q(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(t){return new e({collection:[t],manifest:[t],canvas:[t],annotationCollection:[t],annotationPage:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],geoJson:[t],specificResource:[t],agent:[t]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=(0,x.a)(e.thumbnail).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(t=>this.traverseAgent(t,e))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.service&&(e.service=(0,x.a)(e.service).map(e=>this.traverseService(e))),e.services&&(e.services=(0,x.a)(e.services).map(t=>this.traverseService(t,e))),e.logo&&(e.logo=e.logo.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.homepage&&(e.homepage=(0,x.a)(e.homepage).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(t=>"string"!=typeof t&&t.type?"Canvas"===t.type?this.traverseType(t,{parent:e},this.traversals.canvas):"AnnotationCollection"===t.type?this.traverseType(t,{parent:e},this.traversals.annotationCollection):"Collection"===t.type?this.traverseType(t,{parent:e},this.traversals.collection):this.traverseType(t,{parent:e},this.traversals.contentResource):this.traverseType(t,{parent:e},this.traversals.contentResource))),e.start&&(N(e.start)?e.start=this.traverseSpecificResource(e.start,"Canvas",e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&(e.rendering=e.rendering.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&(e.navPlace=this.traverseGeoJson(e.navPlace,e)),e}traverseManifestItems(e){return e.items&&(e.items=e.items.map(e=>this.traverseCanvas(e))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return"string"==typeof e||!e||e.annotations&&(e.annotations=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(t=>this.traverseAnnotation(t,e))),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&(e.body=this.traverseContentResource(e.body,e)),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(e){return"string"==typeof e||!e||e&&e.service&&(e.service=(0,x.a)(e.service||[]).map(t=>this.traverseService(t,e))),e}traverseContentResource(e,t){return"Choice"===e.type&&(e.items=e.items.map(t=>this.traverseContentResource(t,e))),N(e)?this.traverseSpecificResource(e,"ContentResource"):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:t},this.traversals.contentResource)}traverseSpecificResource(e,t,i){let r=e.source;return"string"==typeof e.source&&(r={id:e.source,type:t||"unknown"}),this.traverseType({...e,source:"Canvas"===t||"Canvas"===r.type?this.traverseType(r,{parent:i},this.traversals.canvas):"ContentResource"===t?this.traverseContentResource(r,{parent:i}):this.traverseUnknown(r,{parent:i,typeHint:t})},{parent:i},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(t=>"string"==typeof t?this.traverseCanvas({id:t,type:"Canvas"},e):N(t)?this.traverseSpecificResource(t,"Canvas",e):"Manifest"===t.type?this.traverseManifest(t,e):this.traverseRange(t,e))),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,i){return i.reduce((e,i)=>{let r=i(e,t);return typeof r>"u"&&!this.options.allowUndefinedReturn?e:r},e)}traverseService(e,t){let i=Object.assign({},e);return i&&i.service&&(i.service=(0,x.a)(i.service).map(e=>this.traverseService(e))),this.traverseType(i,{parent:t},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:i}={}){let r=function(e,t){if(typeof e>"u"||null===e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e){if(t)return t;throw Error(`${typeof e} is not a valid entity`)}if("string"==typeof e.type){let t=F.indexOf(e.type);if(-1!==t)return F[t]}if(e.profile)return"Service";throw Error("Resource type is not known")}(e,i);switch(r){case"Collection":return this.traverseCollection(e,t);case"Manifest":return this.traverseManifest(e,t);case"Canvas":return this.traverseCanvas(e,t);case"AnnotationPage":return this.traverseAnnotationPage(e,t);case"Annotation":return this.traverseAnnotation(e,t);case"ContentResource":return this.traverseContentResource(e,t);case"Range":return this.traverseRange(e,t);case"Service":return this.traverseService(e,t);case"Agent":return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}},B={},J="iiif-parser:hasPart",V="iiif-parser:partOf",z="iiif-parser:isExternal",H="__$UNSET$__",Q="__$UNWRAP$__",G=[];function W(e,t){if(t&&t["@explicit"]){let i={};for(let r of Object.keys(t))r===V||"@explicit"===r||(function(e){if(e===B||0===Object.keys(e).length)return!0;for(let t in e)return!1;return!0}(t[r])?i[r]=e[r]:i[r]=t[r]);return i}return e}Object.freeze(G),Object.freeze(B);var Y={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:G,label:null,thumbnail:G,summary:null,requiredStatement:null,metadata:G,rights:null,provider:G,items:G,seeAlso:G,homepage:G,rendering:G,service:G},X={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:G,thumbnail:G,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:G,rights:null,navDate:null,provider:G,items:G,annotations:G,seeAlso:G,homepage:G,partOf:G,rendering:G,service:G,duration:0,height:0,width:0},K={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:G,thumbnail:G,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:G,rights:null,navDate:null,provider:G,items:G,annotations:G,seeAlso:G,homepage:G,partOf:G,rendering:G,service:G,services:G},Z={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:G,behavior:G,homepage:G,items:G,label:null,metadata:G,navDate:null,provider:G,partOf:G,accompanyingCanvas:null,placeholderCanvas:null,rendering:G,requiredStatement:null,rights:null,seeAlso:G,service:G,services:G,start:null,structures:G,summary:null,thumbnail:G,viewingDirection:"left-to-right"},ee={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:G,thumbnail:G,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:G,rights:null,navDate:null,provider:G,items:G,annotations:G,seeAlso:G,homepage:G,partOf:G,rendering:G,service:G,start:null,supplementary:null,viewingDirection:"left-to-right"},et={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:G,seeAlso:G,homepage:G},ei={id:"https://iiif-parser/empty-service",type:"UnknownService"};function er(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw Error(`Invalid resource does not have an ID (${JSON.stringify(e)}, ${t})`);return e}function en(e,t,i){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type){if("ImageService3"===t.type)return t;if("ImageService3"===e.type)return e;throw Error(`Can only merge entities with identical identifiers and type! ${t.type}(${t.id}) => ${e.type}(${e.id})`)}return function e(t,i,r){if(!i)return t;if(Array.isArray(t)){if(!Array.isArray(i))throw Error("Cannot merge array with non-array");let r=[...t];for(let n of i)if(n["@id"]&&!n.id&&(n.id=n["@id"]),n["@type"]&&!n.type&&(n.type=n["@type"]),null!=n){if(Array.isArray(n))r.push(n);else if("object"==typeof n&&n.id&&n.type){let t=r.findIndex(e=>e.id===n.id&&e.type===n.type);t>=0&&(r[t]=e(r[t],n))}else -1===t.indexOf(n)&&r.push(n)}return r}if("object"==typeof t){if(Array.isArray(i)||"object"!=typeof i)throw Error("Cannot merge object with non-object");let n={...t},s=[],a=[],o=Object.keys(t).filter(e=>e!==J&&"id"!==e&&"type"!==e),l={},u={};for(let[t,r]of Object.entries(i)){if(t===J||"id"===t||"type"===t)continue;let i=n[t];i===r?a.push(t):i!==G&&i?(i&&r&&(l[t]=i,u[t]=r),n[t]=e(i,r),n[t]===l[t]&&(a.push(t),delete l[t])):(s.push(t),n[t]=r)}if(r&&(r.parent&&r.parent.id||r.isTopLevel)){let e=[],i={};if(r.parent?i[V]=r.parent.id:r.isTopLevel&&(i[V]=t.id),n[J]&&n[J].length){let t=!(n[J]||[]).find(e=>e["@explicit"]),r=s.length>0||a.length!==o.length;if(t&&r)for(let t of n[J]){let i={...t},r=Object.keys(l);if(i){for(let e of(i["@explicit"]=!0,o))e!==J&&(i[e]=B);for(let e of r)i[e]=l[e]}e.push(i)}else e.push(...n[J]);if(r){let e=Object.keys(u);for(let e of(i["@explicit"]=!0,s))i[e]=B;for(let e of a)i[e]=B;for(let t of e)i[t]=u[t]}}i.id=n.id,i.type=n.type,e.push(i),n[J]=e}return n}return t||i}({...e},t,i)}function es(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${function(e){let t=JSON.stringify(e),i=5381,r=t.length;for(;r;)i=33*i^t.charCodeAt(--r);let n=(i>>>0).toString(16);return n.length%2?"0"+n:n}(t)}`,type:e,...t}}function ea(e){return t=>({...e,...t})}function eo(e){return Array.isArray(e)?e:[e]}function el(e){return e.body&&(e.body=eo(e.body)),e.seeAlso&&(e.seeAlso=eo(e.seeAlso)),e.audience&&(e.audience=eo(e.audience)),e.accessibility&&(e.accessibility=eo(e.accessibility)),e.motivation&&(e.motivation=eo(e.motivation)),e}function eu(e,{typeHint:t,partOfTypeHint:i}={}){let r;if("string"==typeof e&&(e={id:e,type:t||"unknown"}),N(e))return"string"==typeof e.source&&(e.source={id:e.source,type:t||"unknown"}),"Canvas"===e.source.type&&e.source.partOf&&"string"==typeof e.source.partOf&&(e.source.partOf=[{id:e.source.partOf,type:i||"Manifest"}]),e;if(-1!==(e.id||"").indexOf("#")){let[t,i]=(e.id||"").split("#");e.id=t,i&&(r={type:"FragmentSelector",value:i})}return{type:"SpecificResource",source:e,selector:r}}function ec(e){let t=Object.assign({},e);return e&&e.items&&(t.items=e.items.map(e=>"string"==typeof e||"Canvas"===e.type?eu(e):e)),t}function ep(e){let t=Object.assign({},e);return t.start?(t.start=eu(t.start,{typeHint:"Canvas"}),t):e}function ed(e){let t=Object.assign({},e);return t.target?(t.target=function e(t,i={}){if(Array.isArray(t))return e(t[0]);if("string"==typeof t){let[e,r]=t.split("#");return r?{type:"SpecificResource",source:{id:e,type:i.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:r}}:{type:"SpecificResource",source:{id:e,type:i.typeMap&&i.typeMap[e]||i.typeHint||"Unknown"}}}if("Choice"===t.type||"List"===t.type||"Composite"===t.type||"Independents"===t.type)return e(t.items[0]);if(!t.type&&"source"in t&&(t.type="SpecificResource"),"SpecificResource"===t.type)return"Canvas"===t.source.type&&t.source.partOf&&"string"==typeof t.source.partOf&&(t.source.partOf=[{id:t.source.partOf,type:"Manifest"}]),t.selector?{type:"SpecificResource",source:t.source,selector:t.selector}:{type:"SpecificResource",source:t.source};if(t.id){"Canvas"===t.type&&t.partOf&&"string"==typeof t.partOf&&(t.partOf=[{id:t.partOf,type:"Manifest"}]);let[e,i]=t.id.split("#");return i?{type:"SpecificResource",source:{...t,id:e},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{...t,id:e}}}return{type:"SpecificResource",source:t}}(t.target,{typeHint:"Canvas"}),t):e}function ef(e){return e}function ey(e){return typeof e.items>"u"&&(e[z]=!0),e}function eh(e,{allowSourceString:t=!0,allowString:i=!1,allowedStringType:r}={}){let n=e=>{if(t&&e&&e.source&&"string"!=typeof e.source){let t=Object.keys(e.source);if(e.source.id&&e.source.type&&2===t.length)return{...e,source:e.source.id}}return e};if(e){if(e.source&&e.source.partOf)return n(e);let t=Object.keys(e);if(2===t.length&&e.type&&e.source||3===t.length&&e.type&&e.source&&-1!==t.indexOf("selector")&&!e.selector)return i&&(!r||r===e.source.type)?e.source.id:"ContentResource"===e.source.type?{type:"SpecificResource",source:e.source.id}:e.source;if(e.selector&&!Array.isArray(e.selector)&&"string"!=typeof e.selector&&"FragmentSelector"===e.selector.type){let t=`${e.source.id}#${e.selector.value}`;return i?t:{id:t,type:e.source.type}}}return n(e)}function ev(e){if(!e)return;let t=Object.keys(e);if(0!==t.length){if(1===t.length){let i=t[0];if(!i)return"";let r=(e[i]||[]).join("");return"@none"===i||"none"===i||"en"===i?r:{"@language":i,"@value":r}}return t.map(t=>({"@language":t,"@value":(e[t]||[]).join("")}))}}function eg(e,t=!1){if(e)return e.length>1&&!t?e:e[0]||void 0}function em(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){let t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function eb(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0],["license",e.license?e.license:void 0]]}function*eA(e){let t=e.provider?yield e.provider[0]:void 0;return[["label",ev(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(e=>({label:ev(e.label)||"",value:ev(e.value)||""})):void 0],["description",ev(e.summary)],["thumbnail",eg((yield e.thumbnail))],["navDate",e.navDate],["logo",t?eg(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?ev(e.requiredStatement.value):void 0]]}function*eS(e){let t=e.start&&e.start.type&&"SpecificResource"===e.start.type?eh(e.start):e.start;return[["seeAlso",eg((yield e.seeAlso))],["service",eg((e.service||[]).map(em))],["rendering",eg((yield e.rendering))],["startCanvas",t?t.id:void 0]]}var eC={Manifest:function*(e,t,{isTopLevel:i}){return[...i?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...eb(e,"sc:Manifest"),...yield*eA(e),...yield*eS(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",(yield e.structures)]]},Canvas:function*(e){let t=(yield e.items)[0];return[...eb(e,"sc:Canvas"),...yield*eA(e),...yield*eS(e),["images",t?[t.resources]:void 0],["annotations",e.annotations&&e.annotations.length?eg((yield e.annotations)):void 0]]},AnnotationPage:function*(e){return[...eb(e,"sc:AnnotationList"),...yield*eA(e),["resources",e.items&&e.items.length?eg((yield e.items)):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",function e(t){return Array.isArray(t)?t.map(t=>e(t)):"string"==typeof t?t:t.type&&"Canvas"===t.type?t.id:t}(e.target)],["resource",eg((yield e.body),!0)]]},ContentResource:function*(e){return"Image"===e.type?[...eb(e,"dctypes:Image"),...yield*eA(e),...yield*eS(e)]:[...eb(e,void 0),...yield*eA(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",ev(e.label)]]},Collection:function*(e){return[...eb(e,"sc:Collection"),...yield*eA(e),...yield*eS(e),["members",(yield*e.items)]]},Range:function*(e){let t=[],i=[];if(e.items)for(let r of e.items){let n="SpecificResource"===r.type?r.source:r;if(n){let s=yield n;t.push({"@id":function(e){if(e&&"SpecificResource"===e.type){let t=e.id,i=e.selector?Array.isArray(e.selector)?e.selector[0]:e.selector:void 0;return i&&"FragmentSelector"===i.type&&(t+="#"+i.value),t}return e?.id}(r),"@type":n.type,label:s?s.label:void 0,within:e.id}),"Canvas"===n.type&&i.push(n.id)}}return[...eb(e,"sc:Range"),...yield*eA(e),...yield*eS(e),["canvases",i.length===t.length?i:void 0],["members",i.length!==t.length?t:void 0]]}};function eR(e){return[["id",e.id?.startsWith("vault://")?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height||void 0],["width",e.width||void 0],["duration",e.duration||void 0],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation],[J,H]]}function eO(e){if(e===H||!e||0===e.length)return;let t=e.filter(e=>e!==H);if(0!==t.length)return t}function ew(e){if(e&&e.type&&"ImageService2"===e.type){let{id:t,type:i,profile:r,...n}=e,s="string"==typeof r?r:Array.isArray(r)?r.find(e=>"string"==typeof e):"";return{"@id":t,"@type":i,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function eE(e){if(Array.isArray(e)||(e=e?[e]:[]),!(!e||0===e.length))return e.map(ew)}function*eT(e){return[["label",e.label],["metadata",eO(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",Array.isArray(e.rights)?e.rights[0]||void 0:e.rights||void 0],["navDate",e.navDate],["language",e.language],["thumbnail",eO((yield e.thumbnail))],["placeholderCanvas",(yield e.placeholderCanvas)],["accompanyingCanvas",(yield e.accompanyingCanvas)],["provider",eO((yield e.provider))]]}function*e_(e,t){let i=[];for(let r of e.partOf||[])"Manifest"===r.type&&"Manifest"===t.type||i.push((yield r));return[["seeAlso",eO((yield e.seeAlso))],["service",eO(eE(e.service))],["services",eO(eE(e.services))],["rendering",eO((yield e.rendering))],["supplementary",eO((yield e.supplementary))],["homepage",eO((yield e.homepage))],["logo",eO((yield e.logo))],["partOf",eO(i)],["start",e.start?eh(e.start):e.start]]}var eI={Manifest:function*(e,t,{isTopLevel:i}){return i?[["@context",e["@context"]?e["@context"]:"http://iiif.io/api/presentation/3/context.json"],...eR(e),...yield*eT(e),...yield*e_(e),["items",(yield e.items)],["structures",eO((yield e.structures))],["annotations",eO((yield e.annotations))],["navPlace",e.navPlace]]:[...eR(e),...yield*eT(e)]},Canvas:function*(e,t,{parent:i}){return i&&"Manifest"!==i.type&&"Canvas"!==i.type?[["id",e.id]]:[...eR(e),...yield*eT(e),...yield*e_(e,i),["items",(yield e.items)],["annotations",eO((yield e.annotations))],["navPlace",e.navPlace]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*e_(e)]},AnnotationPage:function*(e){let t=Object.entries(e).map(([e,t])=>[e,Array.isArray(t)?eO(t):t]).filter(([e,t])=>"items"!==e&&"id"!==e&&e!==J&&e!==V&&e!==z),i=yield e.items;return[["id",e.id?.startsWith("vault://")?void 0:e.id],...t,...yield*e_(e),["items",i.length||!1===e[z]?i:H]]},Service:function*(e){return[[Q,ew(e)]]},Annotation:function*(e){let t=Object.entries(e).map(([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:"target"===e?[e,eh(t,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[e,Array.isArray(t)?eO(t):t]).filter(([e])=>"body"!==e&&e!==J&&e!==z),i;if(Array.isArray(e.body)){let t=[];for(let i of e.body)if(i&&N(i)){let e={...i};"Canvas"!==i.source.type?e.source=yield i.source:e.source=i.source,t.push(eh(e,{allowSourceString:!0}))}else t.push((yield i));i=t}else e.body&&N(e.body)?(i={...e.body}).source=yield e.body.source:i=yield e.body;return[...t,...yield*eT(e),...yield*e_(e),["body",1===i.length?i[0]:i]]},ContentResource:function*(e){return function(e,t){let i=Object.keys(t),r=e.map(([e])=>e);for(let n of i)n===J||n===z||-1===r.indexOf(n)&&"u">typeof t[n]&&e.push([n,t[n]]);return e}([...eR(e),...yield*eT(e),...yield*e_(e),["annotations",eO((yield e.annotations))],["items",eO((yield e.items))]],e)},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:i}){return i?[["@context","http://iiif.io/api/presentation/3/context.json"],...eR(e),...yield*eT(e),...yield*e_(e),["items",eO((yield e.items))],["navPlace",e.navPlace]]:[...eR(e),...yield*eT(e)]},Range:function*(e){let t=[];for(let i of e.items)"Range"===i.type?t.push((yield i)):i&&"SpecificResource"===i.type?t.push(eh(i)):t.push(i);return[...eR(e),...yield*eT(e),...yield*e_(e),["items",t],["annotations",eO((yield e.annotations))],["navPlace",e.navPlace]]}},ek=(e,t)=>{var i;let r,n,s,a,o,l;let{entities:u,resource:c,mapping:p}=(r=(0,U.h)(t),s={},i=n={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},a=(e,t)=>{let n=i[e]?i[e]:{};return(i,s)=>{let a=er(i,t||e);return a&&a.id&&e?(n[a.id]=n[a.id]?en(n[a.id],a,{parent:s.parent,isTopLevel:r.id===a.id}):en({id:a.id,type:a.type},a,{parent:s.parent,isTopLevel:r.id===a.id}),{id:a.id,type:"ContentResource"===e?e:a.type}):a}},o=(e,t)=>i=>{let{id:r,type:n}=er(i,t||e);if(typeof r>"u")throw Error("Found invalid entity without an ID.");return"ContentResource"===e||"Service"===e?s[r]=e:s[r]=n,i},l=new $({collection:[ey,ea(K),o("Collection"),a("Collection")],manifest:[ey,ea(Z),ep,o("Manifest"),a("Manifest")],canvas:[ea(X),o("Canvas"),a("Canvas")],annotationPage:[ey,es("AnnotationPage"),ea(Y),o("AnnotationPage"),a("AnnotationPage")],annotation:[es("Annotation"),el,ed,o("Annotation"),a("Annotation")],contentResource:[es("ContentResource"),o("ContentResource"),a("ContentResource")],range:[ea(ee),ec,o("Range","Canvas"),a("Range","Canvas")],agent:[ea(et),o("Agent"),a("Agent")],specificResource:[ef],service:[e=>{n.Service=n.Service?n.Service:{};let t=e.id||e["@id"],i=function(e){let t=Object.assign({},e);if(t["@id"]&&(t.id=t["@id"]),t["@type"]&&(t.type=t["@type"]),t.service){let e=[];for(let i of(t.service=Array.isArray(t.service)?t.service:[t.service],t.service))e.push({id:i["@id"]||i.id,type:i["@type"]||i.type});t.service=e}return Object.assign({},ei,t)}(e);return i&&i.id&&(n.Service[i.id]?n.Service[t]=en(n.Service[t],i):n.Service[t]=i),e}]}).traverseUnknown(r),{entities:n,resource:l,mapping:s});if(void 0===c.id)return[I({id:e,message:"ID is not defined in resource."})];let d=[y({entities:u}),b({mapping:p})];return c.id!==e&&(d.push(m({id:e,type:c.type})),d.push(k({requestId:e,actualId:c.id}))),d.push(P({id:e})),d},eP=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function eD(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){var i,r;if(!((i=e[n])===(r=t[n])||eP(i)&&eP(r)))return!1}return!0}function eM(e,t,i){let r=e.iiif.requests[t],n=e.iiif.mapping[t];if(!n||!e.iiif.entities[n][r.resourceUri])return;let s=e.iiif.entities[n][r.resourceUri];if(s&&s[J]){let e=s[J].find(e=>i?e[V]===i.id:e[V]===s.id);return W(s,e)}return s}function ej(e,t,{waitTimeout:i=30}={}){return(r,n)=>{let s=e.getStore(),a=s.getState(),o=a.iiif.requests[r];if(o){if(o.loadingState===C){let e=eM(a,r);if(e)return e}switch(o.loadingState){case A:break;case S:return(async()=>{let e;let t=!1;try{let n=await Promise.race([new Promise((i,n)=>{t||(e=s.subscribe(()=>{let e=s.getState();if(e.iiif.requests[r].loadingState===A){n();return}if(e.iiif.requests[r].loadingState===C){let t=eM(e,r);t?i(t):n()}}))}),new Promise((e,r)=>setTimeout(()=>{t=!0,r()},6e4*i))]);if(e&&e(),n)return n}catch(t){e&&e()}})()}}e.dispatch(_({id:r}));let l=t=>{if(!t)return;t.id||t["@id"]||(t["@type"]&&(t["@id"]=r),t.id=r);let i=ek(r,t);return e.dispatch(j({actions:i})),eM(s.getState(),r)};try{let i=t(r,n);if(i&&"function"==typeof i.then)return(async()=>{try{return l(await i)}catch(t){throw e.dispatch(I({id:r,message:t.toString()})),t}})();return l(i)}catch(t){throw e.dispatch(I({id:r,message:t.toString()})),t}}}var eU="@iiif/SET_META_VALUE",ex="@iiif/SET_META_VALUE_DYNAMIC",eL="@iiif/UNSET_META_VALUE",eN=r(eU)(),eq=r(ex)(),eF=(r(eL)(),{setMetaValue:eN,setMetaValueDynamic:eq});function e$(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}var eB=e=>{let t;let i=new Set,r=(e,r)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=r?r:"object"!=typeof n||null===n)?n:Object.assign({},t,n),i.forEach(i=>i(t,e))}},n=()=>t,s={setState:r,getState:n,getInitialState:()=>a,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},a=t=e(r,n,s);return s},eJ=e=>e?eB(e):eB,eV=(e,t)=>(i,r,n)=>(n.dispatch=t=>(i(i=>e(i,t),!1,t),t),n.dispatchFromDevtools=!0,{dispatch:(...e)=>n.dispatch(...e),...t}),ez=new Map,eH=e=>{let t=ez.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},eQ=(e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};let r=ez.get(i.name);if(r)return{type:"tracked",store:e,...r};let n={connection:t.connect(i),stores:{}};return ez.set(i.name,n),{type:"tracked",store:e,...n}},eG=(e,t={})=>(i,r,n)=>{let s;let{enabled:a,anonymousActionType:o,store:l,...u}=t;try{s=(null==a||a)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!s)return a&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,r,n);let{connection:c,...p}=eQ(l,s,u),d=!0;n.setState=(e,t,s)=>{let a=i(e,t);if(!d)return a;let p=void 0===s?{type:o||"anonymous"}:"string"==typeof s?{type:s}:s;return void 0===l?null==c||c.send(p,r()):null==c||c.send({...p,type:`${l}/${p.type}`},{...eH(u.name),[l]:n.getState()}),a};let f=(...e)=>{let t=d;d=!1,i(...e),d=t},y=e(n.setState,r,n);if("untracked"===p.type?null==c||c.init(y):(p.stores[p.store]=n,null==c||c.init(Object.fromEntries(Object.entries(p.stores).map(([e,t])=>[e,e===p.store?y:t.getState()])))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1,t=n.dispatch;n.dispatch=(...i)=>{"__setState"!==i[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return c.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return eW(e.payload,e=>{if("__setState"===e.type){if(void 0===l){f(e.state);return}1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[l];if(null==t)return;JSON.stringify(n.getState())!==JSON.stringify(t)&&f(t);return}n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":if(f(y),void 0===l)return null==c?void 0:c.init(n.getState());return null==c?void 0:c.init(eH(u.name));case"COMMIT":if(void 0===l){null==c||c.init(n.getState());break}return null==c?void 0:c.init(eH(u.name));case"ROLLBACK":return eW(e.state,e=>{if(void 0===l){f(e),null==c||c.init(n.getState());return}f(e[l]),null==c||c.init(eH(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return eW(e.state,e=>{if(void 0===l){f(e);return}JSON.stringify(n.getState())!==JSON.stringify(e[l])&&f(e[l])});case"IMPORT_STATE":{let{nextLiftedState:i}=e.payload,r=null==(t=i.computedStates.slice(-1)[0])?void 0:t.state;if(!r)return;void 0===l?f(r):f(r[l]),null==c||c.send(null,i);break}case"PAUSE_RECORDING":return d=!d}return}}),y},eW=(e,t)=>{let i;try{i=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==i&&t(i)},eY=e=>(t,i,r)=>{let n=r.subscribe;return r.subscribe=(e,t,i)=>{let s=e;if(t){let n=(null==i?void 0:i.equalityFn)||Object.is,a=e(r.getState());s=i=>{let r=e(i);if(!n(a,r)){let e=a;t(a=r,e)}},(null==i?void 0:i.fireImmediately)&&t(a,a)}return n(s)},e(t,i,r)};function eX(e,t,i,r){return!(!e[i]||!e[i][t]||!e[i][t][r]||!Array.isArray(e[i][t][r]))}function eK(e){return e.payload}function eZ(e,t){return void 0===e?t:e}function e0(e={}){let t=Object.keys(e);return function(i={},r){let n=!1,s={};for(let a=0;a<t.length;a++){let o=t[a];s[o]=e[o](i[o],r),n=n||s[o]!==i[o]}return n?s:i}}var e1=e0({mapping:(e={},t)=>{switch(t.type){case v:return{...e,[t.payload.id]:t.payload.type};case g:return{...e,...t.payload.mapping};default:return e}},entities:(e=e$(),t)=>{let i=(i,r)=>({...e,[eK(t).type]:{...e[eK(t).type],[eK(t).id]:{...i,...r}}});switch(t.type){case s:{if(!e[eK(t).type]||!e[eK(t).type][eK(t).id])return e;let r=e[eK(t).type][eK(t).id];if("string"==typeof r)return e;return i(r,{[eK(t).key]:eK(t).value})}case a:{if(!eX(e,eK(t).id,eK(t).type,eK(t).key))return e;let r=e[eK(t).type][eK(t).id];if("string"==typeof r)return e;let n=Array.from(r[eK(t).key]),[s]=n.splice(eK(t).startIndex,1);return n.splice(eK(t).endIndex,0,s),i(r,{[eK(t).key]:n})}case n:{let i=Object.keys(eK(t).entities),r={...e};for(let n of i){let i=eK(t).entities[n],s={...e[n]||{}},a=!1,o=Object.keys(i||{})||[];if(i&&o){for(let t of o)a=!0,s[t]=e[n][t]?function(e,t){let i={},r=[];for(let[n,s]of Object.entries(e||{})){r.push(n);let e=(t||{})[n];if(!e||0===e.length){i[n]=s;continue}i[n]=e}for(let[e,n]of Object.entries(t||{}))-1===r.indexOf(e)&&(i[e]=n);return i}(e[n][t],i[t]):i[t];a&&(r[n]=s)}}return r}case o:{if(!eX(e,eK(t).id,eK(t).type,eK(t).key))return e;let r=e[eK(t).type][eK(t).id],n=Array.from(r[eK(t).key]);return n.splice(eZ(eK(t).index,n.length+1),0,eK(t).reference),i(r,{[eK(t).key]:n})}case l:case u:{if(!eX(e,eK(t).id,eK(t).type,eK(t).key))return e;let r=e[eK(t).type][eK(t).id],n=Array.from(r[eK(t).key]),s=eZ(eK(t).index,n.findIndex(e=>e&&e.id===eK(t).reference.id));if(-1===s||n[s]?.id!==eK(t).reference.id)return e;return t.type===l?n.splice(s,1,eK(t).reference):n.splice(s,1),i(r,{[eK(t).key]:n})}case c:{let r=e[eK(t).type][eK(t).id];if(!r)return e;let n=Array.from(r.metadata||[]),s=eK(t);return n.splice(eZ(t.payload.beforeIndex,n.length+1),0,{label:s.label,value:s.label}),i(r,{metadata:n})}case f:{let r=e[eK(t).type][eK(t).id];if("string"==typeof r||!r)return e;let n=Array.from(r.metadata||[]),[s]=n.splice(eK(t).startIndex,1);return n.splice(eK(t).endIndex,0,s),i(r,{metadata:n})}case d:case p:{let r=e[eK(t).type][eK(t).id],n=Array.from(r.metadata||[]),s=eK(t).atIndex;if(void 0===s||-1===s||!n[s])return e;return t.type===d?n.splice(s,1,{label:eK(t).label,value:eK(t).value}):n.splice(s,1),i(r,{metadata:n})}default:return e}},requests:(e={},t)=>{switch(t.type){case R:case T:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:S,uriMismatch:!1,resourceUri:t.payload.id}};case w:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case O:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:A,error:t.payload.message}};case E:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:C,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:r,value:n,meta:s,key:a}=t&&t.payload||{};switch(t.type){case eU:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:n}}};case ex:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:r(e[i]&&e[i][s]?e[i][s][a]:void 0)}}};case eL:if(e[i]&&e[i][s]&&e[i][s][a])return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:void 0}}};return e;default:return e}}}),e2=Object.defineProperty;Object.prototype.hasOwnProperty;var e3=(e,t,i)=>t in e?e2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,e6=(e,t,i)=>(e3(e,"symbol"!=typeof t?t+"":t,i),i);function e4(e,t,i,r=!0){t[e7]=t[e7]||[],t[e7].push(e);let n=new Map;Object.defineProperty(t,e,{enumerable:r,get(){if(void 0===t[e5][e])return;let r=t[e5][e];if(!r)return r;let s=i.get(t[e5][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return n.has(s)||(n.clear(),n.set(s,te(s,i))),n.get(s)},set(r){t[e5][e]!==r&&(this[e8]?i.modifyEntityField({id:this.id,type:this.type},e,function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&t.type?{id:t.id,type:t.type}:t}(r)):this[e5][e]=r)}})}var e5=Symbol.for("_refs_"),e8=Symbol.for("_reactive_"),e7=Symbol.for("_defined_"),e9=Symbol.for("_parent_");function te(e,t,i=!1,r){if(Array.isArray(e))return e.map(e=>te(e,t,i));if(!e||!e.type||!e.id)return e;let n=Object.assign(Object.create(function(e,t=!1,i){let r={id:"",type:"unknown",[e7]:[],[e5]:{},[e9]:null,[e8]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[e8])return this[e8]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let e=this.unwrap();for(let t of Object.keys(e||{}))this[e7].includes(t)?this[e5][t]=e[t]:this[t]=e[t]}},unreactive(){this[e8]&&(this[e8](),this[e8]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let t=this[e9];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(t,i=!0){return e.subscribe(()=>this.id?e.get(this.id):null,t,i)}};return e4("items",r,e),e4("annotations",r,e),e4("structures",r,e),e4("seeAlso",r,e),e4("rendering",r,e),e4("partOf",r,e),e4("start",r,e,!1),e4("supplementary",r,e),e4("homepage",r,e),e4("thumbnail",r,e),e4("placeholderCanvas",r,e,!1),e4("accompanyingCanvas",r,e,!1),e4("provider",r,e),e4("body",r,e),e4("logo",r,e),r}(t,i)),e);return i&&n.reactive(),n}function tt(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var ti=class{constructor(e,t){var i;e6(this,"options"),e6(this,"store"),e6(this,"emitter"),e6(this,"isBatching",!1),e6(this,"batchQueue",[]),e6(this,"remoteFetcher"),e6(this,"staticFetcher"),e6(this,"defaultFetcher",e=>fetch(e).then(e=>{if(200===e.status)return e.json();{let t=Error(`${e.status} ${e.statusText}`);throw t.name="HTTPError",t}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let{enableDevtools:i=!1,iiifStoreName:r="iiif",defaultState:n={iiif:{entities:e$(),meta:{},mapping:{},requests:{}}},customReducers:s={}}=e,a=(t=e0({[r]:e1,...s}),(e,i)=>i&&i.type===D?i.payload.actions.reduce(t,e):i&&i.type===M?{...e,iiif:{...e.iiif,...i.payload.state}}:t(e,i));return eJ(eY(("undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?eG:(e,t)=>e)(eV(a,n),{enabled:i})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter={all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map(function(e){e(t)}),(r=i.get("*"))&&r.slice().map(function(i){i(e,t)})}},this.remoteFetcher=ej(this,this.options.customFetcher),this.staticFetcher=ej(this,(e,t)=>t)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(j({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(j({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(h({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===D){for(let t of e.payload.actions)this.emitter.emit(t.type,{action:t,state:this.store.getState()});this.store.dispatch(e);let t=this.getState();for(let i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t});return}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){return function(e,t,i){if(!t.type||!t.id)throw Error("Unknown entity");if(!i[t.type])throw Error(`Serializer not found for ${t.type}`);return function r(n,s,a=0){let o=i[n.type];if(!o)return H;if(a>20)throw Error("Circular reference: "+n.id+" "+n.type);let[l,u]=function e(t,i,r){let n=function e(t,i){let r=i||"unknown";if(!t)return;if("string"==typeof t)return{id:t,type:r};if(N(t))return e(t.source,i);let n=r&&"unknown"!==r?r:t.type||t["@type"],s=t.id||t["@id"];if(n&&-1!==n.indexOf(":")&&(n=n.split(":").pop()),s&&n)return{id:s,type:n}}(i);if(!n)return[void 0,void 0];let s=t.requests[n.id],a=n.type||t.mapping[n.id];if(!a||s&&s.resourceUri&&(!t.entities[a]||!t.entities[a][s.resourceUri]))return[void 0,void 0];let o=t.entities[a][s?s.resourceUri:n.id];if(n.type&&!o)return e(t,{id:n.id},r);if(o&&o[J]){let e=o[J].find(e=>r?e[V]===r.id:e[V]===o.id);return[W(o,e),o]}return[o,o]}(e,n.type?n:n.id,s)||(n.id&&n.type?n:null);if(!l)return H;let c=o(l,e,{parent:s,isTopLevel:t.id===n.id,fullResource:u}),p=c.next();for(;!p.done;){let e=p.value,t=H;if(e){if(Array.isArray(e)){let i=[];for(let t of e)i.push(r(t,n,a+1));t=i}else t=r(e,n,a+1)}p=c.next(t)}return p.value===H?H:function(e){let t={};for(let[i,r]of e){if(i===Q&&r!==H)return r;r!==H&&"u">typeof r&&null!==r&&(t[i]=r)}return t}(p.value)}(t)}(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,eC)}toPresentation3(e){return this.serialize(e,eI)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:r=!0}=i||{},n=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(e=>this.get(e,i));let s=this.getState();if(N(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){let i=tt(t||s.iiif.mapping[e]);if(!i)return r?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!n&&!i.skipPartOfCheck){let t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(n=t),"string"==typeof t.id&&(n=t.id))}let a=tt(t||e?.type),o=e?.id,l=s.iiif.entities[a];if(!l){let t=s.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,i):r?null:e}let u=l[e.id];if(u&&u[J]){let e=u[J].find(e=>n?e[V]===n:e[V]===u.id);return W(u,e)}return l[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(void 0===e)return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{let i=e(this.get(t,{skipSelfReturn:!1})),r=e=>this.deep(e,i);return r.size=Array.isArray(i)?i.length:1,r}catch(t){let e=e=>this.deep(e,void 0);return e.size=0,e}let i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}loadCollection(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}load(e,t){let i="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(i,t)):Promise.resolve(this.remoteFetcher(i))}loadSync(e,t){let i="string"==typeof e?e:e.id;return this.staticFetcher(i,t)}loadManifestSync(e,t){let i="string"==typeof e?e:e.id;return this.loadSync(i,t)}loadCollectionSync(e,t){let i="string"==typeof e?e:e.id;return this.loadSync(i,t)}areInputsEqual(e,t){return eD(e,t)}subscribe(e,t,i){return void 0===i&&(void 0===t||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,e=>t(e,this),{equalityFn:eD,fireImmediately:!i})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];return i?t?i[t]:i:void 0}getObject(e,t,i={}){let{reactive:r,...n}=i;return te(this.get(e,t,n),this,r)}async loadObject(e,t){return te(await this.load(e,t),this)}async loadManifestObject(e,t){return te(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return te(await this.loadCollection(e,t),this)}wrapObject(e){return te(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return!!e[e7]}setMetaValue([e,t,i],r){this.dispatch("function"==typeof r?eF.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):eF.setMetaValue({id:e,meta:t,key:i,value:r}))}}},9772:function(e,t,i){i.d(t,{o0:function(){return n}});var r=i(6030).Buffer;function n(e){let t=(function(e){let t=e.length%4;if(1===t)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return e+(t?"====".slice(0,4-t):"")})(e).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent("undefined"==typeof atob?r.from(t,"base64").toString("utf-8"):atob(t)).trim()}}}]);