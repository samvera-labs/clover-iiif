"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[996],{7632:function(e,t,i){let r;i.d(t,{Z:function(){return o}});var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));var o=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();let o=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=o[e];return t}return function(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}(o)}},9290:function(e,t,i){i.d(t,{ML:function(){return n},o0:function(){return s}});var r=i(1876).Buffer;function n(e){let t=encodeURIComponent(e);return(typeof btoa>"u"?r.from(t,"utf-8").toString("base64"):btoa(t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function s(e){let t=(function(e){let t=e.length%4;if(1===t)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return e+(t?"====".slice(0,4-t):"")})(e).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(typeof atob>"u"?r.from(t,"base64").toString("utf-8"):atob(t)).trim()}},3845:function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,i){var n;return(n=function(e,t){if("object"!=r(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=r(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==r(n)?n:n+"")in e)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{w:function(){return n}})},8013:function(e,t,i){i.d(t,{j:function(){return ta}});var r=i(3845),n=i(1041);let s=function(e){return function(){let t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},a="@iiif/IMPORT_ENTITIES",o="@iiif/MODIFY_ENTITY_FIELD",l="@iiif/REORDER_ENTITY_FIELD",u="@iiif/MOVE_ENTITY",c="@iiif/MOVE_ENTITIES",p="@iiif/ADD_REFERENCE",d="@iiif/UPDATE_REFERENCE",f="@iiif/CHANGE_REFERENCE_IDENTIFIER",y="@iiif/REMOVE_REFERENCE",h="@iiif/ADD_METADATA",v="@iiif/REMOVE_METADATA",g="@iiif/UPDATE_METADATA",m="@iiif/REORDER_METADATA",b=s(a)(),S=s(o)(),A=(s(l)(),s(u)(),s(c)(),s(p)(),s(y)(),s(d)(),s(f)(),s(h)(),s(g)(),s(v)(),s(m)(),"@iiif/ADD_MAPPING"),C="@iiif/ADD_MAPPINGS",R=s(A)(),w=s(C)(),E="RESOURCE_ERROR",O="RESOURCE_LOADING",T="RESOURCE_READY",I="@iiif/REQUEST_RESOURCE",P="@iiif/REQUEST_ERROR",_="@iiif/REQUEST_MISMATCH",k="@iiif/REQUEST_COMPLETE",M="@iiif/REQUEST_OFFLINE_RESOURCE",j=s(I)(),D=s(P)(),x=s(_)(),U=s(k)(),L=(s(M)(),"@iiif/BATCH"),N="@iiif/BATCH_IMPORT",F=s(L)();s(N)();let q="@iiif/SET_META_VALUE",V="@iiif/SET_META_VALUE_DYNAMIC",$="@iiif/UNSET_META_VALUE",B=s(q)(),J=s(V)(),z=(s($)(),{setMetaValue:B,setMetaValueDynamic:J});var H=i(1131);function Y(e){return"string"!=typeof e&&(e&&!e.type&&"source"in e?(e.type="SpecificResource",!0):!!e&&"SpecificResource"===e.type)}function Q(...e){return t=>e.reduce((e,t)=>t(e),t)}let G=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];var W=class e{constructor(e,t={}){(0,H.w2)(this,"traversals",void 0),(0,H.w2)(this,"options",void 0),(0,H.w2)(this,"_traverseManifest",Q(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,H.w2)(this,"_traverseCanvas",Q(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,H.w2)(this,"_traverseAnnotationPage",Q(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),(0,H.w2)(this,"_traverseRange",Q(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(t){return new e({collection:[t],manifest:[t],canvas:[t],annotationCollection:[t],annotationPage:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],geoJson:[t],specificResource:[t],agent:[t]})}traverseDescriptive(e){return e.thumbnail&&=(0,H.rY)(e.thumbnail).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.provider&&=e.provider.map(t=>this.traverseAgent(t,e)),e}traverseLinking(e){return e.seeAlso&&=(0,H.rY)(e.seeAlso).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.service&&=(0,H.rY)(e.service).map(e=>this.traverseService(e)),e.services&&=(0,H.rY)(e.services).map(t=>this.traverseService(t,e)),e.logo&&=(0,H.rY)(e.logo).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.homepage&&=(0,H.rY)(e.homepage).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.partOf&&=e.partOf.map(t=>"string"!=typeof t&&t.type?"Canvas"===t.type?this.traverseType(t,{parent:e},this.traversals.canvas):"AnnotationCollection"===t.type?this.traverseType(t,{parent:e},this.traversals.annotationCollection):"Collection"===t.type?this.traverseType(t,{parent:e},this.traversals.collection):this.traverseType(t,{parent:e},this.traversals.contentResource):this.traverseType(t,{parent:e},this.traversals.contentResource)),e.start&&(Y(e.start)?e.start=this.traverseSpecificResource(e.start,"Canvas",e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&=e.rendering.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.supplementary&&=e.supplementary.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&=this.traverseGeoJson(e.navPlace,e),e}traverseManifestItems(e){return e.items&&=e.items.map(e=>this.traverseCanvas(e)),e}traverseManifestStructures(e){return e.structures&&=e.structures.map(e=>this.traverseRange(e)),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return"string"!=typeof e&&e&&(e.annotations&&=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&=e.items.map(t=>this.traverseAnnotation(t,e)),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&=this.traverseContentResource(e.body,e),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&=this.traverseCanvas(e.placeholderCanvas),e.accompanyingCanvas&&=this.traverseCanvas(e.accompanyingCanvas),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(e){return"string"==typeof e||!e||e&&e.service&&(e.service=(0,H.rY)(e.service||[]).map(t=>this.traverseService(t,e))),e}traverseContentResource(e,t){return"Choice"===e.type&&(e.items=e.items.map(t=>this.traverseContentResource(t,e))),Y(e)?this.traverseSpecificResource(e,"ContentResource"):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:t},this.traversals.contentResource)}traverseSpecificResource(e,t,i){let r=e.source;return"string"==typeof e.source&&(r={id:e.source,type:t||"unknown"}),this.traverseType({...e,source:"Canvas"===t||"Canvas"===r.type?this.traverseType(r,{parent:i},this.traversals.canvas):"ContentResource"===t?this.traverseContentResource(r,{parent:i}):this.traverseUnknown(r,{parent:i,typeHint:t})},{parent:i},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&=e.items.map(t=>"string"==typeof t?this.traverseCanvas({id:t,type:"Canvas"},e):Y(t)?this.traverseSpecificResource(t,"Canvas",e):"Manifest"===t.type?this.traverseManifest(t,e):this.traverseRange(t,e)),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,i){return i.reduce((e,i)=>{let r=i(e,t);return void 0!==r||this.options.allowUndefinedReturn?r:e},e)}traverseService(e,t){let i=Object.assign({},e);return i&&i.service&&(i.service=(0,H.rY)(i.service).map(e=>this.traverseService(e))),this.traverseType(i,{parent:t},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:i}={}){let r=function(e,t){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e){if(t)return t;throw Error(`${typeof e} is not a valid entity`)}if("string"==typeof e.type){let t=G.indexOf(e.type);if(-1!==t)return G[t]}if(e.profile)return"Service";throw Error("Resource type is not known")}(e,i);switch(r){case"Collection":return this.traverseCollection(e,t);case"Manifest":return this.traverseManifest(e,t);case"Canvas":return this.traverseCanvas(e,t);case"AnnotationPage":return this.traverseAnnotationPage(e,t);case"Annotation":return this.traverseAnnotation(e,t);case"ContentResource":return this.traverseContentResource(e,t);case"Range":return this.traverseRange(e,t);case"Service":return this.traverseService(e,t);case"Agent":return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}},X=i(8558);function K(e,t){let i=t||"unknown";if(!e)return;if("string"==typeof e)return{id:e,type:i};if(Y(e))return K(e.source,t);let r=i&&"unknown"!==i?i:e.type||e["@type"],n=e.id||e["@id"];if(r&&-1!==r.indexOf(":")&&(r=r.split(":").pop()),n&&r)return{id:n,type:r}}let Z={},ee="iiif-parser:hasPart",et="iiif-parser:partOf",ei="iiif-parser:isExternal",er="__$UNSET$__",en="__$UNWRAP$__",es=[];function ea(e,t){if(t&&t["@explicit"]){let i={};for(let r of Object.keys(t))r!==et&&"@explicit"!==r&&(function(e){if(e===Z||0===Object.keys(e).length)return!0;for(let t in e)return!1;return!0}(t[r])?i[r]=e[r]:i[r]=t[r]);return i}return e}Object.freeze(es),Object.freeze(Z);let eo={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:es,label:null,thumbnail:es,summary:null,requiredStatement:null,metadata:es,rights:null,provider:es,items:es,seeAlso:es,homepage:es,rendering:es,service:es},el={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:es,thumbnail:es,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:es,rights:null,navDate:null,provider:es,items:es,annotations:es,seeAlso:es,homepage:es,partOf:es,rendering:es,service:es,duration:0,height:0,width:0},eu={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:es,thumbnail:es,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:es,rights:null,navDate:null,provider:es,items:es,annotations:es,seeAlso:es,homepage:es,partOf:es,rendering:es,service:es,services:es},ec={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:es,behavior:es,homepage:es,items:es,label:null,metadata:es,navDate:null,provider:es,partOf:es,accompanyingCanvas:null,placeholderCanvas:null,rendering:es,requiredStatement:null,rights:null,seeAlso:es,service:es,services:es,start:null,structures:es,summary:null,thumbnail:es,viewingDirection:"left-to-right"},ep={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:es,thumbnail:es,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:es,rights:null,navDate:null,provider:es,items:es,annotations:es,seeAlso:es,homepage:es,partOf:es,rendering:es,service:es,start:null,supplementary:null,viewingDirection:"left-to-right"},ed={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:es,seeAlso:es,homepage:es},ef={id:"https://iiif-parser/empty-service",type:"UnknownService"};function ey(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw Error(`Invalid resource does not have an ID (${JSON.stringify(e)}, ${t})`);return e}function eh(e,t,i){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type){if("ImageService3"===t.type)return t;if("ImageService3"===e.type)return e;throw Error(`Can only merge entities with identical identifiers and type! ${t.type}(${t.id}) => ${e.type}(${e.id})`)}return function e(t,i,r){if(!i)return t;if(Array.isArray(t)){if(!Array.isArray(i))throw Error("Cannot merge array with non-array");let r=[...t];for(let n of i)if(n["@id"]&&!n.id&&(n.id=n["@id"]),n["@type"]&&!n.type&&(n.type=n["@type"]),null!=n){if(Array.isArray(n))r.push(n);else if("object"==typeof n&&n.id&&n.type){let t=r.findIndex(e=>e.id===n.id&&e.type===n.type);t>=0&&(r[t]=e(r[t],n))}else -1===t.indexOf(n)&&r.push(n)}return r}if("object"==typeof t){if(Array.isArray(i)||"object"!=typeof i)throw Error("Cannot merge object with non-object");let n={...t},s=[],a=[],o=Object.keys(t).filter(e=>e!==ee&&"id"!==e&&"type"!==e),l={},u={};for(let[t,r]of Object.entries(i)){if(t===ee||"id"===t||"type"===t)continue;let i=n[t];i===r?a.push(t):i!==es&&i?(i&&r&&(l[t]=i,u[t]=r),n[t]=e(i,r),n[t]===l[t]&&(a.push(t),delete l[t])):(s.push(t),n[t]=r)}if(r&&(r.parent&&r.parent.id||r.isTopLevel)){let e=[],i={};if(r.parent?i[et]=r.parent.id:r.isTopLevel&&(i[et]=t.id),n[ee]&&n[ee].length){let t=!(n[ee]||[]).find(e=>e["@explicit"]),r=s.length>0||a.length!==o.length;if(t&&r)for(let t of n[ee]){let i={...t},r=Object.keys(l);if(i){for(let e of(i["@explicit"]=!0,o))e!==ee&&(i[e]=Z);for(let e of r)i[e]=l[e]}e.push(i)}else e.push(...n[ee]);if(r){let e=Object.keys(u);for(let e of(i["@explicit"]=!0,s))i[e]=Z;for(let e of a)i[e]=Z;for(let t of e)i[t]=u[t]}}i.id=n.id,i.type=n.type,e.push(i),n[ee]=e}return n}return t||i}({...e},t,i)}function ev(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${function(e){let t=JSON.stringify(e),i=5381,r=t.length;for(;r;)i=33*i^t.charCodeAt(--r);let n=(i>>>0).toString(16);return n.length%2?"0"+n:n}(t)}`,type:e,...t}}function eg(e){return t=>({...e,...t})}function em(e){return Array.isArray(e)?e:[e]}function eb(e){return e.body&&=em(e.body),e.seeAlso&&=em(e.seeAlso),e.audience&&=em(e.audience),e.accessibility&&=em(e.accessibility),e.motivation&&=em(e.motivation),e}function eS(e,{typeHint:t,partOfTypeHint:i}={}){let r;if("string"==typeof e&&(e={id:e,type:t||"unknown"}),Y(e))return"string"==typeof e.source&&(e.source={id:e.source,type:t||"unknown"}),"Canvas"===e.source.type&&e.source.partOf&&"string"==typeof e.source.partOf&&(e.source.partOf=[{id:e.source.partOf,type:i||"Manifest"}]),e;if(-1!==(e.id||"").indexOf("#")){let[t,i]=(e.id||"").split("#");e.id=t,i&&(r={type:"FragmentSelector",value:i})}return{type:"SpecificResource",source:e,selector:r}}function eA(e){let t=Object.assign({},e);return e&&e.items&&(t.items=e.items.map(e=>"string"==typeof e||"Canvas"===e.type?eS(e):e)),t}function eC(e){let t=Object.assign({},e);return t.start?(t.start=eS(t.start,{typeHint:"Canvas"}),t):e}function eR(e){let t=Object.assign({},e);return t.target?(t.target=function e(t,i={}){if(Array.isArray(t))return e(t[0]);if("string"==typeof t){let[e,r]=t.split("#");return r?{type:"SpecificResource",source:{id:e,type:i.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:r}}:{type:"SpecificResource",source:{id:e,type:i.typeMap&&i.typeMap[e]||i.typeHint||"Unknown"}}}if("Choice"===t.type||"List"===t.type||"Composite"===t.type||"Independents"===t.type)return e(t.items[0]);if(!t.type&&"source"in t&&(t.type="SpecificResource"),"SpecificResource"===t.type){"Canvas"===t.source.type&&t.source.partOf&&"string"==typeof t.source.partOf&&(t.source.partOf=[{id:t.source.partOf,type:"Manifest"}]);let r="string"==typeof t.source?t.source:t.source.id;if(r?.includes("#")){let n=e(r,i);n&&(t.selector=n.selector,t.source=n.source)}return t.selector?{...t,type:"SpecificResource",source:t.source,selector:t.selector}:{...t,type:"SpecificResource",source:t.source}}if(t.id){"Canvas"===t.type&&t.partOf&&"string"==typeof t.partOf&&(t.partOf=[{id:t.partOf,type:"Manifest"}]);let[e,i]=t.id.split("#");return i?{type:"SpecificResource",source:{...t,id:e},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{...t,id:e}}}return{type:"SpecificResource",source:t}}(t.target,{typeHint:"Canvas"}),t):e}function ew(e){return e}function eE(e){return void 0===e.items&&(e[ei]=!0),e}function eO(e,{allowSourceString:t=!0,allowString:i=!1,allowedStringType:r}={}){let n=e=>{if(t&&e&&e.source&&"string"!=typeof e.source){let t=Object.keys(e.source);if(e.source.id&&e.source.type&&2===t.length)return{...e,source:e.source.id}}return e};if(e){if(e.source&&e.source.partOf)return n(e);let t=Object.keys(e);if(2===t.length&&e.type&&e.source||3===t.length&&e.type&&e.source&&-1!==t.indexOf("selector")&&!e.selector)return i&&(!r||r===e.source.type)?e.source.id:"ContentResource"===e.source.type?{type:"SpecificResource",source:e.source.id}:e.source;if(e.selector&&!Array.isArray(e.selector)&&"string"!=typeof e.selector&&"FragmentSelector"===e.selector.type){let t=`${e.source.id}#${e.selector.value}`;return i?t:{id:t,type:e.source.type}}}return n(e)}function eT(e){if(!e)return;let t=Object.keys(e);if(0!==t.length){if(1===t.length){let i=t[0];if(!i)return"";let r=(e[i]||[]).join("");return"@none"===i||"none"===i||"en"===i?r:{"@language":i,"@value":r}}return t.map(t=>({"@language":t,"@value":(e[t]||[]).join("")}))}}function eI(e,t=!1){if(e)return e.length>1&&!t?e:e[0]||void 0}function eP(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){let t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function e_(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"===e.viewingDirection?void 0:e.viewingDirection],["license",e.license?e.license:void 0]]}function*ek(e){let t=e.provider?yield e.provider[0]:void 0;return[["label",eT(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(e=>({label:eT(e.label)||"",value:eT(e.value)||""})):void 0],["description",eT(e.summary)],["thumbnail",eI((yield e.thumbnail))],["navDate",e.navDate],["logo",t?eI(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?eT(e.requiredStatement.value):void 0]]}function*eM(e){let t=e.start&&e.start.type&&"SpecificResource"===e.start.type?eO(e.start):e.start;return[["seeAlso",eI((yield e.seeAlso))],["service",eI((e.service||[]).map(eP))],["rendering",eI((yield e.rendering))],["startCanvas",t?t.id:void 0]]}let ej={Manifest:function*(e,t,{isTopLevel:i}){return[...i?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...e_(e,"sc:Manifest"),...yield*ek(e),...yield*eM(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",(yield e.structures)]]},Canvas:function*(e){let t=(yield e.items)[0];return[...e_(e,"sc:Canvas"),...yield*ek(e),...yield*eM(e),["images",t?[t.resources]:void 0],["annotations",e.annotations&&e.annotations.length?eI((yield e.annotations)):void 0]]},AnnotationPage:function*(e){return[...e_(e,"sc:AnnotationList"),...yield*ek(e),["resources",e.items&&e.items.length?eI((yield e.items)):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",function e(t){return Array.isArray(t)?t.map(t=>e(t)):"string"==typeof t?t:t.type&&"Canvas"===t.type?t.id:t}(e.target)],["resource",eI((yield e.body),!0)]]},ContentResource:function*(e){return"Image"===e.type?[...e_(e,"dctypes:Image"),...yield*ek(e),...yield*eM(e)]:[...e_(e,void 0),...yield*ek(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",eT(e.label)]]},Collection:function*(e){return[...e_(e,"sc:Collection"),...yield*ek(e),...yield*eM(e),["members",(yield*e.items)]]},Range:function*(e){let t=[],i=[];if(e.items)for(let r of e.items){let n="SpecificResource"===r.type?r.source:r;if(n){let s=yield n;t.push({"@id":function(e){if(e&&"SpecificResource"===e.type){let t=e.id,i=e.selector?Array.isArray(e.selector)?e.selector[0]:e.selector:void 0;return i&&"FragmentSelector"===i.type&&(t+="#"+i.value),t}return e?.id}(r),"@type":n.type,label:s?s.label:void 0,within:e.id}),"Canvas"===n.type&&i.push(n.id)}}return[...e_(e,"sc:Range"),...yield*ek(e),...yield*eM(e),["canvases",i.length===t.length?i:void 0],["members",i.length===t.length?void 0:t]]}};function eD(e){return[["id",e.id?.startsWith("vault://")?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height||void 0],["width",e.width||void 0],["duration",e.duration||void 0],["viewingDirection","left-to-right"===e.viewingDirection?void 0:e.viewingDirection],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation],[ee,er]]}function ex(e){if(e===er||!e||0===e.length)return;let t=e.filter(e=>e!==er);if(0!==t.length)return t}function eU(e){if(e&&e.type&&"ImageService2"===e.type){let{id:t,type:i,profile:r,...n}=e,s="string"==typeof r?r:Array.isArray(r)?r.find(e=>"string"==typeof e):"";return{"@id":t,"@type":i,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function eL(e){if(Array.isArray(e)||(e=e?[e]:[]),!(!e||0===e.length))return e.map(eU)}function*eN(e){return[["label",e.label],["metadata",ex(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",Array.isArray(e.rights)?e.rights[0]||void 0:e.rights||void 0],["navDate",e.navDate],["language",e.language],["thumbnail",ex((yield e.thumbnail))],["placeholderCanvas",(yield e.placeholderCanvas)],["accompanyingCanvas",(yield e.accompanyingCanvas)],["provider",ex((yield e.provider))]]}function*eF(e,t){let i=[];for(let r of e.partOf||[])("Manifest"!==r.type||"Manifest"!==t.type)&&i.push((yield r));return[["seeAlso",ex((yield e.seeAlso))],["service",ex(eL(e.service))],["services",ex(eL(e.services))],["rendering",ex((yield e.rendering))],["supplementary",ex((yield e.supplementary))],["homepage",ex((yield e.homepage))],["logo",ex((yield e.logo))],["partOf",ex(i)],["start",e.start?eO(e.start):e.start]]}let eq={Manifest:function*(e,t,{isTopLevel:i}){if(!i)return[...eD(e),...yield*eN(e),["navPlace",e.navPlace]];let r="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||eV(e))&&(r=["http://iiif.io/api/presentation/3/context.json","http://iiif.io/api/extension/navplace/context.json"]),[["@context",e["@context"]?e["@context"]:r],...eD(e),...yield*eN(e),...yield*eF(e),["items",(yield e.items)],["structures",ex((yield e.structures))],["annotations",ex((yield e.annotations))],["navPlace",e.navPlace]]},Canvas:function*(e,t,{parent:i}){return i&&"Manifest"!==i.type&&"Canvas"!==i.type?[["id",e.id]]:[...eD(e),...yield*eN(e),...yield*eF(e,i),["items",(yield e.items)],["annotations",ex((yield e.annotations))],["navPlace",e.navPlace]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*eF(e)]},AnnotationPage:function*(e){let t=Object.entries(e).map(([e,t])=>[e,Array.isArray(t)?ex(t):t]).filter(([e,t])=>"items"!==e&&"id"!==e&&e!==ee&&e!==et&&e!==ei),i=yield e.items;return[["id",e.id?.startsWith("vault://")?void 0:e.id],...t,...yield*eF(e),["items",i.length||!1===e[ei]?i:er]]},Service:function*(e){return[[en,eU(e)]]},Annotation:function*(e){let t=Object.entries(e).map(([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:"target"===e?[e,eO(t,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[e,Array.isArray(t)?ex(t):t]).filter(([e])=>"body"!==e&&e!==ee&&e!==ei),i;if(Array.isArray(e.body)){let t=[];for(let i of e.body)if(i&&Y(i)){let e={...i};"Canvas"===i.source.type?e.source=i.source:e.source=yield i.source,t.push(eO(e,{allowSourceString:!0}))}else t.push((yield i));i=t}else e.body&&Y(e.body)?(i={...e.body}).source=yield e.body.source:i=yield e.body;return[...t,...yield*eN(e),...yield*eF(e),["body",1===i.length?i[0]:i]]},ContentResource:function*(e){return function(e,t){let i=Object.keys(t),r=e.map(([e])=>e);for(let n of i)n!==ee&&n!==ei&&-1===r.indexOf(n)&&void 0!==t[n]&&e.push([n,t[n]]);return e}([...eD(e),...yield*eN(e),...yield*eF(e),["annotations",ex((yield e.annotations))],["items",ex((yield e.items))]],e)},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:i}){if(i){let t="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||eV(e))&&(t=["http://iiif.io/api/extension/navplace/context.json","http://iiif.io/api/presentation/3/context.json"]),[["@context",t],...eD(e),...yield*eN(e),...yield*eF(e),["items",ex((yield e.items))],["navPlace",e.navPlace]]}return[...eD(e),...yield*eN(e),["navPlace",e.navPlace]]},Range:function*(e){let t=[];for(let i of e.items)"Range"===i.type?t.push((yield i)):i&&"SpecificResource"===i.type?t.push(eO(i)):t.push(i);return[...eD(e),...yield*eN(e),...yield*eF(e),["items",t],["annotations",ex((yield e.annotations))],["navPlace",e.navPlace]]}};function eV(e){if(!e.items||!Array.isArray(e.items))return!1;for(let t of e.items)if(t.navPlace)return!0;return!1}let e$=(e,t)=>{var i;let r,n,s,a,o,l;let{entities:u,resource:c,mapping:p}=(r=(0,X.ki)(t),s={},i=n={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},a=(e,t)=>{let n=i[e]?i[e]:{};return(i,s)=>{let a=ey(i,t||e);return a&&a.id&&e?(n[a.id]=n[a.id]?eh(n[a.id],a,{parent:s.parent,isTopLevel:r.id===a.id}):eh({id:a.id,type:a.type},a,{parent:s.parent,isTopLevel:r.id===a.id}),{id:a.id,type:"ContentResource"===e?e:a.type}):a}},o=(e,t)=>i=>{let{id:r,type:n}=ey(i,t||e);if(void 0===r)throw Error("Found invalid entity without an ID.");return"ContentResource"===e||"Service"===e?s[r]=e:s[r]=n,i},l=new W({collection:[eE,eg(eu),o("Collection"),a("Collection")],manifest:[eE,eg(ec),eC,o("Manifest"),a("Manifest")],canvas:[eg(el),o("Canvas"),a("Canvas")],annotationPage:[eE,ev("AnnotationPage"),eg(eo),o("AnnotationPage"),a("AnnotationPage")],annotation:[ev("Annotation"),eb,eR,o("Annotation"),a("Annotation")],contentResource:[ev("ContentResource"),o("ContentResource"),a("ContentResource")],range:[eg(ep),eA,o("Range","Canvas"),a("Range","Canvas")],agent:[eg(ed),o("Agent"),a("Agent")],specificResource:[ew],service:[e=>{n.Service=n.Service?n.Service:{};let t=e.id||e["@id"],i=function(e){let t=Object.assign({},e);if(t["@id"]&&(t.id=t["@id"]),t["@type"]&&(t.type=t["@type"]),t.service){let e=[];for(let i of(t.service=Array.isArray(t.service)?t.service:[t.service],t.service))e.push({id:i["@id"]||i.id,type:i["@type"]||i.type});t.service=e}return Object.assign({},ef,t)}(e);return i&&i.id&&(n.Service[i.id]?n.Service[t]=eh(n.Service[t],i):n.Service[t]=i),e}]}).traverseUnknown(r),{entities:n,resource:l,mapping:s});if(void 0===c.id)return[D({id:e,message:"ID is not defined in resource."})];let d=[b({entities:u}),w({mapping:p})];return c.id!==e&&(d.push(R({id:e,type:c.type})),d.push(x({requestId:e,actualId:c.id}))),d.push(U({id:e})),d},eB=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function eJ(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){var i,r;if(!((i=e[n])===(r=t[n])||eB(i)&&eB(r)))return!1}return!0}function ez(e,t,i){let r=e.iiif.requests[t],n=e.iiif.mapping[t];if(!n||!e.iiif.entities[n][r.resourceUri])return;let s=e.iiif.entities[n][r.resourceUri];if(s&&s[ee]){let e=s[ee].find(e=>i?e[et]===i.id:e[et]===s.id);return ea(s,e)}return s}function eH(e,t,{waitTimeout:i=30}={}){return(r,n,s)=>{let a=e.getStore(),o=a.getState(),l=o.iiif.requests[r];if(l){if(l.loadingState===T){let e=ez(o,r);if(e)return e}switch(l.loadingState){case E:break;case O:return(async()=>{let e,t=!1;try{let n=await Promise.race([new Promise((i,n)=>{t||(e=a.subscribe(()=>{let e=a.getState();if(e.iiif.requests[r].loadingState===E){n();return}if(e.iiif.requests[r].loadingState===T){let t=ez(e,r);t?i(t):n()}}))}),new Promise((e,r)=>setTimeout(()=>{t=!0,r()},6e4*i))]);if(e&&e(),n)return n}catch{e&&e()}})()}}e.dispatch(j({id:r}));let u=t=>{if(!t)return;t.id||t["@id"]||(t["@type"]&&(t["@id"]=r),t.id=r);let i=e$(r,t);return e.dispatch(F({actions:i})),ez(a.getState(),r)};try{let i=t(r,n);return i&&"function"==typeof i.then?(async()=>{try{let e=await i;return s&&(e=s(e)),u(e)}catch(t){throw e.dispatch(D({id:r,message:t.toString()})),t}})():u(s?s(i):i)}catch(t){throw e.dispatch(D({id:r,message:t.toString()})),t}}}var eY=i(8568);function eQ(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let eG=(e,t)=>(i,r,n)=>(n.dispatch=t=>(i(i=>e(i,t),!1,t),t),n.dispatchFromDevtools=!0,{dispatch:(...e)=>n.dispatch(...e),...t}),eW=new Map,eX=e=>{let t=eW.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},eK=(e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};let r=eW.get(i.name);if(r)return{type:"tracked",store:e,...r};let n={connection:t.connect(i),stores:{}};return eW.set(i.name,n),{type:"tracked",store:e,...n}},eZ=(e,t={})=>(i,r,n)=>{let{enabled:s,anonymousActionType:a,store:o,...l}=t,u;try{u=(s??!0)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!u)return s&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,r,n);let{connection:c,...p}=eK(o,u,l),d=!0;n.setState=(e,t,s)=>{let u=i(e,t);if(!d)return u;let p=void 0===s?{type:a||"anonymous"}:"string"==typeof s?{type:s}:s;return void 0===o?c?.send(p,r()):c?.send({...p,type:`${o}/${p.type}`},{...eX(l.name),[o]:n.getState()}),u};let f=(...e)=>{let t=d;d=!1,i(...e),d=t},y=e(n.setState,r,n);if("untracked"===p.type?c?.init(y):(p.stores[p.store]=n,c?.init(Object.fromEntries(Object.entries(p.stores).map(([e,t])=>[e,e===p.store?y:t.getState()])))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1,t=n.dispatch;n.dispatch=(...i)=>{"__setState"!==i[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return c.subscribe(e=>{switch(e.type){case"ACTION":if("string"!=typeof e.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return e0(e.payload,e=>{if("__setState"===e.type){if(void 0===o){f(e.state);return}1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[o];if(null==t)return;JSON.stringify(n.getState())!==JSON.stringify(t)&&f(t);return}n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return f(y),void 0===o?c?.init(n.getState()):c?.init(eX(l.name));case"COMMIT":if(void 0===o){c?.init(n.getState());break}return c?.init(eX(l.name));case"ROLLBACK":return e0(e.state,e=>{if(void 0===o){f(e),c?.init(n.getState());return}f(e[o]),c?.init(eX(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return e0(e.state,e=>{if(void 0===o){f(e);return}JSON.stringify(n.getState())!==JSON.stringify(e[o])&&f(e[o])});case"IMPORT_STATE":{let{nextLiftedState:t}=e.payload,i=t.computedStates.slice(-1)[0]?.state;if(!i)return;f(void 0===o?i:i[o]),c?.send(null,t);break}case"PAUSE_RECORDING":return d=!d}return}}),y},e0=(e,t)=>{let i;try{i=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==i&&t(i)},e1=e=>(t,i,r)=>{let n=r.subscribe;return r.subscribe=(e,t,i)=>{let s=e;if(t){let n=i?.equalityFn||Object.is,a=e(r.getState());s=i=>{let r=e(i);if(!n(a,r)){let e=a;t(a=r,e)}},i?.fireImmediately&&t(a,a)}return n(s)},e(t,i,r)};function e2(e,t,i,r){return!(!e[i]||!e[i][t]||!e[i][t][r]||!Array.isArray(e[i][t][r]))}function e3(e){return e.payload||{}}function e6(e,t){if(!(!t?.id||!t?.type))return e[t.type]?.[t.id]}function e8(e,t){return void 0===e?t:e}let e4=(e=eQ(),t)=>{let i=(i,r)=>({...e,[e3(t).type]:{...e[e3(t).type],[e3(t).id]:{...i,...r}}});switch(t.type){case o:{if(!e[e3(t).type]||!e[e3(t).type][e3(t).id])return e;let r=e[e3(t).type][e3(t).id];return"string"==typeof r?e:i(r,{[e3(t).key]:e3(t).value})}case l:{if(!e2(e,e3(t).id,e3(t).type,e3(t).key))return e;let r=e[e3(t).type][e3(t).id];if("string"==typeof r)return e;let n=Array.from(r[e3(t).key]),[s]=n.splice(e3(t).startIndex,1);return n.splice(e3(t).endIndex,0,s),i(r,{[e3(t).key]:n})}case c:{let i=e3(t).subjects,r=e3(t).from,n=e3(t).to||r,s=e6(e,r),a=n?.key||r.key;if(!e2(e,r.id,r.type,r.key)||!e2(e,n.id,n.type,n.key))return e;let o=[],l=[];if("slice"===i.type){let e=i.startIndex,t=i.length;l=(o=Array.from(s[r.key])).splice(e,t)}else{let e=Array.from(s[r.key]);for(let t of i.items){let i=function(e,t,i){if(!e[t]||!Array.isArray(e[t]))return null;let r=void 0===i.index?e[t].findIndex(e=>!!e&&K(e)?.id===i.id):i.index;return -1===r?null:{entity:e[t][r],index:r}}(s,r.key,t);i&&(l.push(i.entity),e[i.index]=null),o=e.filter(e=>null!==e)}}let u={...s,[r.key]:o},c={...e,[r.type]:{...e[r.type],[r.id]:u}},p=e6(c,n);if(!p)return e;let d=n?.index===void 0?p[a].length:n.index,f=Array.from(p[n.key]);f.splice(d,0,...l);let y={...p,[a]:f};return{...c,[n.type]:{...c[n.type],[n.id]:y}}}case u:return e4(e,{type:c,payload:{subjects:{type:"list",items:[e3(t).subject]},from:e3(t).from,to:e3(t).to}});case f:{let{id:r,index:n,key:s,newIdentifier:a,reference:o,type:l}=e3(t),u=e[l][r],c=K(o);if(!u||!u[s]||!c||n<0)return e;let p=u[s],d=p[n],f=e[c.type]?.[c.id];if(!f||!d)return e;let y=Y(d)?"string"==typeof d.source?{...d,source:a}:{...d,source:{...d.source||{},id:a}}:{...d,id:a},h=Array.from(p);h.splice(e8(n,h.length+1),1,y);let v=i(u,{[s]:h}),g={...f,id:a};g["iiif-parser:hasPart"]&&=g["iiif-parser:hasPart"].filter(e=>e["iiif-parser:partOf"]===r).map(e=>({...e,id:a}));let m={...v[c.type],[a]:g};return v[c.type]=m,v}case a:{let i=Object.keys(e3(t).entities),r={...e};for(let n of i){let i=e3(t).entities[n],s={...e[n]||{}},a=!1,o=Object.keys(i||{})||[];if(i&&o){for(let t of o)a=!0,s[t]=e[n][t]?function(e,t){let i={},r=[];for(let[n,s]of Object.entries(e||{})){r.push(n);let e=(t||{})[n];if(!e||0===e.length){i[n]=s;continue}i[n]=e}for(let[e,n]of Object.entries(t||{}))-1===r.indexOf(e)&&(i[e]=n);return i}(e[n][t],i[t]):i[t];a&&(r[n]=s)}}return r}case p:{if(!e2(e,e3(t).id,e3(t).type,e3(t).key))return e;let r=e[e3(t).type][e3(t).id],n=Array.from(r[e3(t).key]);return n.splice(e8(e3(t).index,n.length+1),0,e3(t).reference),i(r,{[e3(t).key]:n})}case d:case y:{if(!e2(e,e3(t).id,e3(t).type,e3(t).key))return e;let r=e[e3(t).type][e3(t).id],n=Array.from(r[e3(t).key]),s=e8(e3(t).index,n.findIndex(e=>e&&e.id===e3(t).reference.id));return -1===s||n[s]?.id!==e3(t).reference.id?e:(t.type===d?n.splice(s,1,e3(t).reference):n.splice(s,1),i(r,{[e3(t).key]:n}))}case h:{let r=e[e3(t).type][e3(t).id];if(!r)return e;let n=Array.from(r.metadata||[]),s=e3(t);return n.splice(e8(t.payload.beforeIndex,n.length+1),0,{label:s.label,value:s.label}),i(r,{metadata:n})}case m:{let r=e[e3(t).type][e3(t).id];if("string"==typeof r||!r)return e;let n=Array.from(r.metadata||[]),[s]=n.splice(e3(t).startIndex,1);return n.splice(e3(t).endIndex,0,s),i(r,{metadata:n})}case g:case v:{let r=e[e3(t).type][e3(t).id],n=Array.from(r.metadata||[]),s=e3(t).atIndex;return void 0!==s&&-1!==s&&n[s]?(t.type===g?n.splice(s,1,{label:e3(t).label,value:e3(t).value}):n.splice(s,1),i(r,{metadata:n})):e}default:return e}};function e5(e={}){let t=Object.keys(e);return function(i={},r){let n=!1,s={};for(let a=0;a<t.length;a++){let o=t[a];s[o]=e[o](i[o],r),n||=s[o]!==i[o]}return n?s:i}}let e9=e5({mapping:(e={},t)=>{switch(t.type){case A:return{...e,[t.payload.id]:t.payload.type};case C:return{...e,...t.payload.mapping};default:return e}},entities:e4,requests:(e={},t)=>{switch(t.type){case I:case M:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:O,uriMismatch:!1,resourceUri:t.payload.id}};case _:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case P:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:E,error:t.payload.message}};case k:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:T,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:r,value:n,meta:s,key:a}=t&&t.payload||{};switch(t.type){case q:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:n}}};case V:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:r(e[i]&&e[i][s]?e[i][s][a]:void 0)}}};case $:return e[i]&&e[i][s]&&e[i][s][a]?{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[a]:void 0}}}:e;default:return e}}});function e7(e,t,i,r=!0){t[ti]=t[ti]||[],t[ti].push(e);let n=new Map;Object.defineProperty(t,e,{enumerable:r,get(){if(void 0===t[te][e])return;let r=t[te][e];if(!r)return r;let s=i.get(t[te][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return n.has(s)||(n.clear(),n.set(s,tn(s,i))),n.get(s)},set(r){t[te][e]!==r&&(this[tt]?i.modifyEntityField({id:this.id,type:this.type},e,function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&t.type?{id:t.id,type:t.type}:t}(r)):this[te][e]=r)}})}let te=Symbol.for("_refs_"),tt=Symbol.for("_reactive_"),ti=Symbol.for("_defined_"),tr=Symbol.for("_parent_");function tn(e,t,i=!1,r){if(Array.isArray(e))return e.map(e=>tn(e,t,i));if(!e||!e.type||!e.id)return e;let n=Object.assign(Object.create(function(e,t=!1,i){let r={id:"",type:"unknown",[ti]:[],[te]:{},[tr]:null,[tt]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[tt])return this[tt]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let e=this.unwrap();for(let t of Object.keys(e||{}))this[ti].includes(t)?this[te][t]=e[t]:this[t]=e[t]}},unreactive(){this[tt]&&(this[tt](),this[tt]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let t=this[tr];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(t,i=!0){return e.subscribe(()=>this.id?e.get(this.id):null,t,i)}};return e7("items",r,e),e7("annotations",r,e),e7("structures",r,e),e7("seeAlso",r,e),e7("rendering",r,e),e7("partOf",r,e),e7("start",r,e,!1),e7("supplementary",r,e),e7("homepage",r,e),e7("thumbnail",r,e),e7("placeholderCanvas",r,e,!1),e7("accompanyingCanvas",r,e,!1),e7("provider",r,e),e7("body",r,e),e7("logo",r,e),r}(t,i)),e);return i&&n.reactive(),n}function ts(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var ta=class{constructor(e,t){(0,r.w)(this,"options",void 0),(0,r.w)(this,"store",void 0),(0,r.w)(this,"emitter",void 0),(0,r.w)(this,"isBatching",!1),(0,r.w)(this,"batchQueue",[]),(0,r.w)(this,"remoteFetcher",void 0),(0,r.w)(this,"staticFetcher",void 0),(0,r.w)(this,"defaultFetcher",e=>fetch(e).then(e=>{if(200===e.status)return e.json();{let t=Error(`${e.status} ${e.statusText}`);throw t.name="HTTPError",t}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let{enableDevtools:i=!1,iiifStoreName:r="iiif",defaultState:n={iiif:{entities:eQ(),meta:{},mapping:{},requests:{}}},customReducers:s={}}=e,a=(t=e5({[r]:e9,...s}),(e,i)=>i&&i.type===L?i.payload.actions.reduce(t,e):i&&i.type===N?{...e,iiif:{...e.iiif,...i.payload.state}}:t(e,i)),o=!!("u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__);return(0,eY.M)(e1((o?eZ:(e,t)=>e)(eG(a,n),{enabled:i})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=(0,n.O)(),this.remoteFetcher=eH(this,this.options.customFetcher),this.staticFetcher=eH(this,(e,t)=>t)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(F({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(F({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(S({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===L){for(let t of e.payload.actions)this.emitter.emit(t.type,{action:t,state:this.store.getState()});this.store.dispatch(e);let t=this.getState();for(let i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t});return}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){return function(e,t,i){if(!t.type||!t.id)throw Error("Unknown entity");if(!i[t.type])throw Error(`Serializer not found for ${t.type}`);return function r(n,s,a=0){let o=i[n.type];if(!o)return er;if(a>20)throw Error("Circular reference: "+n.id+" "+n.type);let[l,u]=function e(t,i,r){let n=K(i);if(!n)return[void 0,void 0];let s=t.requests[n.id],a=n.type||t.mapping[n.id];if(!a||s&&s.resourceUri&&(!t.entities[a]||!t.entities[a][s.resourceUri]))return[void 0,void 0];let o=t.entities[a][s?s.resourceUri:n.id];if(n.type&&!o)return e(t,{id:n.id},r);if(o&&o[ee]){let e=o[ee].find(e=>r?e[et]===r.id:e[et]===o.id);return[ea(o,e),o]}return[o,o]}(e,n.type?n:n.id,s)||(n.id&&n.type?n:null);if(!l)return er;let c=o(l,e,{parent:s,isTopLevel:t.id===n.id,fullResource:u}),p=c.next();for(;!p.done;){let e=p.value,t=er;if(e){if(Array.isArray(e)){let i=[];for(let t of e)i.push(r(t,n,a+1));t=i}else t=r(e,n,a+1)}p=c.next(t)}return p.value===er?er:function(e){let t={};for(let[i,r]of e){if(i===en&&r!==er)return r;r!==er&&null!=r&&(t[i]=r)}return t}(p.value)}(t)}(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,ej)}toPresentation3(e){return this.serialize(e,eq)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:r=!0}=i||{},n=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(e=>this.get(e,i));let s=this.getState();if(Y(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){let i=ts(t||s.iiif.mapping[e]);if(!i)return r?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!n&&!i.skipPartOfCheck){let t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(n=t),"string"==typeof t.id&&(n=t.id))}let a=ts(t||e?.type),o=e?.id,l=s.iiif.entities[a];if(!l){let t=s.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,i):r?null:e}let u=l[e.id];if(u&&u[ee]){let e=u[ee].find(e=>n?e[et]===n:e[et]===u.id);return ea(u,e)}return l[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(void 0===e)return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{let i=e(this.get(t,{skipSelfReturn:!1})),r=e=>this.deep(e,i);return r.size=Array.isArray(i)?i.length:1,r}catch{let e=e=>this.deep(e,void 0);return e.size=0,e}let i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t,i){let r="string"==typeof e?e:e.id;return this.load(r,t,i)}loadCollection(e,t,i){let r="string"==typeof e?e:e.id;return this.load(r,t,i)}load(e,t,i){let r="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(r,t,i)):Promise.resolve(this.remoteFetcher(r,{},i))}loadSync(e,t,i){let r="string"==typeof e?e:e.id;return this.staticFetcher(r,t,i)}loadManifestSync(e,t,i){let r="string"==typeof e?e:e.id;return this.loadSync(r,t,i)}loadCollectionSync(e,t,i){let r="string"==typeof e?e:e.id;return this.loadSync(r,t,i)}areInputsEqual(e,t){return eJ(e,t)}subscribe(e,t,i){return void 0===i&&(void 0===t||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,e=>t(e,this),{equalityFn:eJ,fireImmediately:!i})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getPaginationState(e){let t="string"==typeof e?e:e.id;if(!t)return null;let i=this.getResourceMeta(t,"@vault/pagination");if(i?.state)return i.state;let r=this.get(e);if(r.first){let e={currentPage:null,currentPageIndex:null,isFetching:!1,isFullyLoaded:!1,next:r.first,page:1,pages:[],previous:null,totalItems:r.total,currentLength:0};return this.setMetaValue([t,"@vault/pagination","state"],e),e}return null}async loadNextPage(e,t){let i,r="string"==typeof e?e:e.id;if(!r)return[null,null];let n=this.getPaginationState(e);if(!n||n.isFullyLoaded||!n.next)return[null,null];if(n.isFetching)return[n,null];let s="string"==typeof n.next?n.next:n.next.id,a=n.currentPage,o={...n,isFetching:!0};this.setMetaValue([r,"@vault/pagination","state"],o);try{i=await this.loadCollection(s,t,e=>{let{id:t,"@id":i,...r}=e||{};return i?{"@id":s,...r}:{id:s,...r}})}catch(t){let e={...n,isFetching:!1,error:t};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}if(!i){let e={...n,isFetching:!1,error:Error("Collection not found")};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}let l=this.get(r),u=[...l.items||[],...i.items||[]].map(e=>({id:e.id,type:e.type}));this.modifyEntityField({id:r,type:"Collection"},"items",u);let c=this.getPaginationState(e);if(!c)throw Error("Pagination state not found");let p={...c,isFetching:!1,error:null,currentPage:i.id,next:i.next?.id||null,currentPageIndex:c.pages.length,currentLength:u.length,pages:[...c.pages,{id:i.id,type:"Collection",startIndex:l.items.length,pageLength:i.items.length,order:"number"==typeof c.currentPageIndex?c.currentPageIndex+1:0}],isFullyLoaded:!i.next,previous:a,page:c.pages.length+1};return this.setMetaValue([r,"@vault/pagination","state"],p),[p,i]}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}getObject(e,t,i={}){let{reactive:r,...n}=i;return tn(this.get(e,t,n),this,r)}async loadObject(e,t){return tn(await this.load(e,t),this)}async loadManifestObject(e,t){return tn(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return tn(await this.loadCollection(e,t),this)}wrapObject(e){return tn(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return!!e[ti]}setMetaValue([e,t,i],r){this.dispatch("function"==typeof r?z.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):z.setMetaValue({id:e,meta:t,key:i,value:r}))}}},1041:function(e,t,i){i.d(t,{O:function(){return r}});function r(e){return{all:e||=new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(e){e(i)}),(r=e.get("*"))&&r.slice().map(function(e){e(t,i)})}}}},8568:function(e,t,i){i.d(t,{M:function(){return n}});let r=e=>{let t,i=new Set,r=(e,r)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=r??("object"!=typeof n||!n)?n:Object.assign({},t,n),i.forEach(i=>i(t,e))}},n=()=>t,s={setState:r,getState:n,getInitialState:()=>a,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},a=t=e(r,n,s);return s},n=e=>e?r(e):r}}]);